<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <meta name="apple-mobile-web-app-capable" content="no"/>
    <meta name="wap-font-scale" content="no">
    <meta content="telephone=no" name="format-detection">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <title>双11专题</title>
    <link rel="stylesheet" href="css/public.phone.min.css"/>
    <link rel="stylesheet" href="css/css.css"/>
</head>
<body class="main-body">
<div class="lottery-bar">
    <h2 class="lottery-title">
        <a class="lottery-back" href="javascript:;">返回</a>
        <span>双11狂欢节</span>
        <a class="lottery-share" href="javascript:;">分享</a>
    </h2>

    <div class="lottery-menu">
        <div class="menu-container">
            <ul>
                <li><a href="#1F">爆款大聚会</a></li>
                <li><a href="#2F">精品水果</a></li>
                <li><a href="#3F">休闲零嘴</a></li>
                <li><a href="#4F">特色生鲜</a></li>
                <li><a href="#5F">肉类精品</a></li>
                <li><a href="#6F">酒水茶饮</a></li>
                <li><a href="#7F">油粮干货</a></li>
                <li><a href="#8F">特色精选</a></li>
            </ul>
        </div>
        <a class="menu-btn" href="javascript:;">展开</a>
    </div>

    <div class="lottery-container">
        <div class="lottery-header">
            <img src="img/header.jpg">

            <div class="lottery-time">
                <label>距离<i>11.11 狂欢节</i>开幕：</label>
                <span class="timeDay">99</span>天<span class="timeHour">23</span>时<span
                    class="timeMinute">59</span>分<span class="timeSecond">59</span>秒
            </div>
        </div>
        <div class="floor floor1">
            <a href="#"><img src="img/pro-big-img1.jpg"></a>
            <a href="#"><img src="img/pro-big-img2.jpg"></a>
            <a href="#"><img src="img/pro-big-img3.jpg"></a>
            <a href="#"><img src="img/pro-big-img4.jpg"></a>
            <a href="#"><img src="img/pro-big-img5.jpg"></a>
            <a href="#"><img src="img/pro-big-img6.jpg"></a>
        </div>
        <div class="floor floor2">
            <h2><img src="img/title1.jpg"></h2>

            <div class="floor-cont">
                <img src="img/product-fruit.jpg">

                <div class="floor-product">
                    <a href="#"></a>
                    <a href="#"></a>
                    <a href="#"></a>
                </div>
            </div>
        </div>
        <div class="floor floor3">
            <h2><img src="img/title2.jpg"></h2>

            <div class="floor-cont">
                <img src="img/product-snack.jpg">

                <div class="floor-product">
                    <a href="#"></a>
                    <a href="#"></a>
                    <a href="#"></a>
                </div>
            </div>
        </div>
        <div class="floor floor4">
            <h2><img src="img/title3.jpg"></h2>

            <div class="floor-cont">
                <img src="img/product-fresh1.jpg">

                <div class="floor-product">
                    <a href="#"></a>
                    <a href="#"></a>
                    <a href="#"></a>
                </div>
            </div>
            <div class="floor-cont">
                <img src="img/product-fresh2.jpg">

                <div class="floor-product">
                    <a href="#"></a>
                    <a href="#"></a>
                    <a href="#"></a>
                </div>
            </div>
        </div>
        <div class="floor floor5">
            <h2><img src="img/title4.jpg"></h2>

            <div class="floor-cont">
                <div class="floor-cont">
                    <img src="img/product-meat1.jpg">

                    <div class="floor-product">
                        <a href="#"></a>
                        <a href="#"></a>
                        <a href="#"></a>
                    </div>
                </div>
                <div class="floor-cont">
                    <img src="img/product-meat2.jpg">

                    <div class="floor-product product-row2">
                        <a href="#"></a>
                        <a href="#"></a>
                    </div>
                </div>
            </div>
        </div>
        <div class="floor floor6">
            <h2><img src="img/title5.jpg"></h2>

            <div class="floor-cont">
                <div class="floor-cont">
                    <img src="img/product-drinks1.jpg">

                    <div class="floor-product">
                        <a href="#"></a>
                        <a href="#"></a>
                        <a href="#"></a>
                    </div>
                </div>
                <div class="floor-cont">
                    <img src="img/product-drinks2.jpg">

                    <div class="floor-product">
                        <a href="#"></a>
                        <a href="#"></a>
                        <a href="#"></a>
                    </div>
                </div>
                <div class="floor-cont">
                    <img src="img/product-drinks3.jpg">

                    <div class="floor-product product-row2">
                        <a href="#"></a>
                        <a href="#"></a>
                    </div>
                </div>
            </div>
        </div>
        <div class="floor floor7">
            <h2><img src="img/title6.jpg"></h2>

            <div class="floor-cont">
                <div class="floor-cont">
                    <img src="img/product-Oilfood1.jpg">

                    <div class="floor-product">
                        <a href="#"></a>
                        <a href="#"></a>
                        <a href="#"></a>
                    </div>
                </div>
                <div class="floor-cont">
                    <img src="img/product-Oilfood2.jpg">

                    <div class="floor-product">
                        <a href="#"></a>
                        <a href="#"></a>
                        <a href="#"></a>
                    </div>
                </div>
            </div>
        </div>
        <div class="floor floor8">
            <h2><img src="img/title7.jpg"></h2>

            <div class="floor-cont">
                <img src="img/product-special.jpg">

                <div class="floor-product">
                    <a href="#"></a>
                    <a href="#"></a>
                    <a href="#"></a>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="js/jquery-1.11.1.min.js"></script>
<script>
    $(function () {
        var _is_click_ = false;
        var _is_current_ = false;

        //倒计时
        var limitTime = function (tag, time, Fun) {
            var _time = 0;
            _time = setInterval(function () {
                var endTime = new Date("" + time + "");
                var curTime = new Date();
                var countTime = parseInt((endTime.getTime() - curTime.getTime()) / 1000);
                var d = parseInt(countTime / (60 * 60 * 24));
                var h = parseInt(countTime / (60 * 60) % 24);
                var m = parseInt(countTime / 60 % 60);
                var s = parseInt(countTime % 60);
                if (countTime <= 0) {
                    d = 0;
                    h = 0;
                    m = 0;
                    s = 0;
                    Fun.call();
                    clearInterval(_time);
                }
                $(tag).find('.timeDay').html(padZero(d, 2));
                $(tag).find('.timeHour').html(padZero(h, 2));
                $(tag).find('.timeMinute').html(padZero(m, 2));
                $(tag).find('.timeSecond').html(padZero(s, 2));
            }, 0);
            return _time;
        };

        var padZero = function (num, n) {
            var len = num.toString().length;
            while (len < n) {
                num = "0" + num;
                len++;
            }
            return num;
        };

        limitTime(".lottery-time", "2016/11/11 11:11:11", function () {
            console.log("倒计时结束！");
        });

        //初始化菜单
        var ele = $(".lottery-menu ul");
        var floor = $(".floor");
        var ul_width = 15, li_width = [];
        var show_num = 0;

        $(window).resize(function () {
            var _w_width = $(this).width();
            var li_all_width = 0;
            ele.find("li").each(function () {
                ul_width += $(this).outerWidth();
                li_width.push($(this).outerWidth());
            });
            for (var i = 0; i <= li_width.length; i++) {
                li_all_width += li_width[i];
                if (li_all_width >= _w_width) {
                    show_num = i;
                    return false;
                }
            }
        }).trigger("resize");

        ele.css("width", ul_width + "px").on("touchstart", startMove)
                .find("a").on("click", goToFloor);

        var saveDate = {}, _is_move_ = false;
        var direction = -1;
        var _link_click = false;
        var _floorID = 0;

        function goToFloor() {
            _link_click = true;
            $(this).parents("li").addClass("active").siblings().removeClass("active");

            var floorID = parseInt($(this).attr("href").substr(1));
            var _curBar = $(this).parents("li");
            var top = $(".floor" + floorID).offset().top;

            _floorID = floorID;

            var _width = _curBar.offset().left + _curBar.outerWidth();
            var _left = 0;

            if (_width >= ($(window).width() - 30)) {
                console.log("0:"+_width);
                if (_curBar.position().left > (ul_width - $(window).width() + 30)) {
                    _left = (ul_width - $(window).width() + 30) * -1;
                    moveFun(_left);
                } else {
                    _left = (_curBar.position().left - _curBar.outerWidth()) * -1;
                    moveFun(_left);
                }
                saveDate.startX = _left;
            } else if (_width < _curBar[0].offsetWidth * 2) {
                console.log("1:"+_left);
                _left = (($(window).width() - 30) - _width) * -1;
                moveFun(_left);
                saveDate.startX = _left;
            }

            if ($(".lottery-menu ul").height() >= 80) {
                scrollToEle(top - 90 - 40);
            } else {
                scrollToEle(top - 90);
            }
        }

        $(document).on("touchstart", function (e) {
            e = event || window.event;
            e.stopPropagation();
            var touch = e.touches[0];
            saveDate.y = touch.pageY;
        });

        $(document).on("touchmove", function (e) {
            e = event || window.event;
            e.stopPropagation();
            var touch = e.touches[0];
            var my = touch.pageY;

            direction = my < saveDate.y ? -1 : 1;
        });

        function startMove(e) {
            e = event || window.event;
            e.stopPropagation();
            //e.preventDefault();
            var touch = e.touches[0];
            if (!_is_move_) {
                _is_move_ = true;
                direction = -1;
                saveDate.x = touch.pageX;
                if (saveDate.startX === undefined || saveDate.endX === undefined) {
                    saveDate.startX = 0;
                } else {
                    if (saveDate.endX > 0) {
                        saveDate.endX = 0;
                    } else if (Math.abs(saveDate.endX) > ul_width - $(window).width() + 30) {
                        saveDate.endX = -( ul_width - $(window).width() + 30);
                    }
                    saveDate.startX = saveDate.endX;
                }

                $(document).on("touchmove", moving);
                $(document).on("touchend", endMove);
            }
        }

        function moving(e) {
            e = event || window.event;
            e.stopPropagation();
            e.preventDefault();
            var touch = e.touches[0];
            if (_is_move_) {
                var mx = touch.pageX;
                if (mx > saveDate.x) direction = 1;
                saveDate.moveX = mx - saveDate.x;
                saveDate.endX = saveDate.startX + saveDate.moveX;
                ele.css({
                    "transition-duration": "0ms",
                    "-webkit-transition-duration": "0ms",
                    "transform": "translateX(" + saveDate.endX + "px)",
                    "-webkit-transform": "-webkit-translateX(" + saveDate.endX + "px)"
                });
            }
        }

        function endMove() {
            _is_move_ = false;
            if (saveDate.endX > 0) {
                moveFun(0)
            } else if (Math.abs(saveDate.endX) >= ul_width - $(window).width() + 30) {
                moveFun(-(ul_width - $(window).width() + 30));
            } else {
                if (Math.abs(saveDate.startX) == 0 || Math.abs(saveDate.startX) == ul_width - $(window).width() + 30) {
                } else {
                    moveFun((saveDate.endX + 10 * direction));
                }
            }

            $(document).off("touchmove", moving);
            $(document).off("touchend", endMove);
        }

        function moveFun(distance) {
            ele.css({
                "transition-duration": "400ms",
                "-webkit-transition-duration": "400ms",
                "transform": "translateX(" + (distance) + "px)",
                "-webkit-transform": "-webkit-translateX(" + (distance) + "px)"
            });
        }

        $(window).scroll(function () {
            var top = $(this).scrollTop();
            var _w_height = $(window).height();
            var _d_height = $(document).height();
            var dom_length = floor.length;

            if ((floor.eq(dom_length - 1).offset().top) < _d_height - _w_height + top) {
                if (_floorID == dom_length) {
                    _link_click = true;
                }
            }
            if (!_link_click) {
                if (top < $(".floor1").offset().top - 100) ele.find("li").removeClass("active");
                floor.each(function () {
                    if (top > ($(this).offset().top - 100) && top < ($(this).offset().top - 100 + $(this).outerHeight())) {
                        var num = parseInt($(this).attr("class").split(" ")[1].substr(5));
//                        console.log(num);
                        var _curBar = ele.find("li").eq(num - 1);
//                        if (num != 1) {
//                            var _width = _curBar.offset().left + _curBar[0].offsetWidth;
//                            if (_width > $(window).width()) {
//                                moveFun(_curBar.offset().left * -1);
//                            } else if (_width < _curBar[0].offsetWidth * 2) {
//                                moveFun(_curBar.offset().left * 1);
//                            }
//                        }

                        _curBar.addClass("active").siblings().removeClass("active");
                    }
                });
            }
        });


        //展开菜单
//        $(".menu-btn").click(function () {
//            var ul = $(this).prevAll(".menu-container").find("ul");
//            var top = $(window).scrollTop();
//            if (!_is_current_) {
//                _is_current_ = true;
//                $(this).toggleClass("active");
//                ul.parents(".lottery-menu").toggleClass("active");
//                if (!_is_click_) {
//                    _is_click_ = true;
//                    ul.css({"overflow": "auto", "width": "auto"}).animate({"height": "80"}, 500, function () {
//                        _is_current_ = false;
//                    });
//                    scrollToEle(top - 40);
//                } else {
//                    _is_click_ = false;
//                    ul.animate({"height": "40"}, 500, function () {
//                        _is_current_ = false;
//                    }).css({"overflow": "hidden"});
//                    scrollToEle(top + 40);
//                }
//            }
//        });


        //页面滚动 动画
        function scrollToEle(top) {
            _link_click = true;
            $("html,body").animate({"scrollTop": top + "px"}, 500, function () {
                _link_click = false;
            });
        }
    })
</script>
</body>
</html>